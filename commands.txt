# install: postgress, postgis, osm2pgsql, 

# create gis db:
# createdb -E UTF-8 -O USERNAME gis
# run postgis SQL scripts, paths on your system may differ:
# psql -d gis -f /usr/local/share/postgis/postgis.sql
# psql -d gis -f /usr/local/share/postgis/spatial_ref_sys.sql 
# psql -d gis -c "CREATE EXTENSION hstore"

# run daily:
wget -N http://download.geofabrik.de/europe/romania-latest.osm.pbf 2> download-status.txt
grep "not retrieving" download-status.txt
if [[ $? -eq 0 ]] ; then
    exit 1
fi
osm2pgsql --slim -d gis -C 16000 --hstore --number-processes 3 --style osm2pgsql.style  romania-latest.osm.pbf 

psql -d gis -f cleanup.sql

psql -t -A -d gis -f smoothness-trunk.sql > main-roads.json
topojson -p -o main-roads.topo.json -- main-roads.json
(echo "mainRoads="; cat main-roads.topo.json ; echo ";";)> main-roads.topo.json.js

psql -t -A -d gis -f smoothness-other.sql > other-roads.json
topojson -p -o other-roads.topo.json -- other-roads.json
(echo "otherRoads="; cat other-roads.topo.json ; echo ";";)> other-roads.topo.json.js

psql -t -A -d gis -f all-roads.sql > all-roads.json
topojson -p -o all-roads.topo.json -- all-roads.json
(echo "allRoads="; cat all-roads.topo.json ; echo ";";)> all-roads.topo.json.js
